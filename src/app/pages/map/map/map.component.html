<div>
  <nav>
    <app-map-header></app-map-header>
  </nav>
  <nav>
    <app-map-menu></app-map-menu>
  </nav>
  <div class="map-top">
    <app-left-header
      class="left-head"
      [mainMap]="map"
      (openPassportRequested)="openPassport($event.type, $event.data)"
    ></app-left-header>
    <div class="container">
      <header>
        <div class="tooltip-container" (click)="zoomIn()">
          <svg
            style="margin-left: 5px"
            width="25"
            height="25"
            viewBox="0 0 20 20"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <g clip-path="url(#clip0_1350_1592)">
              <path
                d="M19.2996 20.0002C19.1196 20.0002 18.9396 19.9302 18.8096 19.8002L16.9496 17.9402C16.6796 17.6702 16.6796 17.2302 16.9496 16.9502C17.2196 16.6802 17.6596 16.6802 17.9396 16.9502L19.7996 18.8102C20.0696 19.0802 20.0696 19.5202 19.7996 19.8002C19.6596 19.9302 19.4796 20.0002 19.2996 20.0002Z"
                fill="#182026"
              />
              <path
                d="M9.5 0C4.26 0 0 4.26 0 9.5C0 14.74 4.26 19 9.5 19C14.74 19 19 14.74 19 9.5C19 4.26 14.74 0 9.5 0ZM12.2 10.45H10.45V12.2C10.45 12.61 10.11 12.95 9.7 12.95C9.29 12.95 8.95 12.61 8.95 12.2V10.45H7.2C6.79 10.45 6.45 10.11 6.45 9.7C6.45 9.29 6.79 8.95 7.2 8.95H8.95V7.2C8.95 6.79 9.29 6.45 9.7 6.45C10.11 6.45 10.45 6.79 10.45 7.2V8.95H12.2C12.61 8.95 12.95 9.29 12.95 9.7C12.95 10.11 12.61 10.45 12.2 10.45Z"
                fill="#182026"
              />
            </g>
            <defs>
              <clipPath id="clip0_1350_1592">
                <rect width="20" height="20" fill="white" />
              </clipPath>
            </defs>
          </svg>
          <div class="tooltip" style="left: 115%">Приблизить</div>
        </div>

        <div class="tooltip-container" (click)="zoomOut()">
          <svg
            width="25"
            height="25"
            viewBox="0 0 20 20"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <g clip-path="url(#clip0_1350_1548)">
              <path
                d="M19.3005 20.0002C19.1205 20.0002 18.9405 19.9302 18.8105 19.8002L16.9505 17.9402C16.6805 17.6702 16.6805 17.2302 16.9505 16.9502C17.2205 16.6802 17.6605 16.6802 17.9405 16.9502L19.8005 18.8102C20.0705 19.0802 20.0705 19.5202 19.8005 19.8002C19.6605 19.9302 19.4805 20.0002 19.3005 20.0002Z"
                fill="#182026"
              />
              <path
                d="M9.5 0C4.26 0 0 4.26 0 9.5C0 14.74 4.26 19 9.5 19C14.74 19 19 14.74 19 9.5C19 4.26 14.74 0 9.5 0ZM12 10.45H7C6.59 10.45 6.25 10.11 6.25 9.7C6.25 9.29 6.59 8.95 7 8.95H12C12.41 8.95 12.75 9.29 12.75 9.7C12.75 10.11 12.41 10.45 12 10.45Z"
                fill="#182026"
              />
            </g>
            <defs>
              <clipPath id="clip0_1350_1548">
                <rect width="20" height="20" fill="white" />
              </clipPath>
            </defs>
          </svg>
          <div class="tooltip">Отдалить</div>
        </div>

        <div
          class="tooltip-container"
          (click)="toggleEditMode()"
          [class.active]="editMode"
        >
          <svg
            width="25"
            height="25"
            viewBox="0 0 640 640"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
            [class.active]="editMode"
          >
            <path
              d="M502.07 1.65836C499.27 2.72502 495.137 4.85836 492.737 6.45836C487.137 10.325 438.47 58.5917 438.47 60.325C438.47 62.1917 577.404 200.992 579.27 200.992C580.07 200.992 592.337 189.125 606.604 174.592C636.604 144.325 638.737 141.125 639.537 124.325C639.937 115.658 639.537 112.192 637.137 105.658C634.337 98.1917 631.27 94.725 589.27 52.5917C537.804 0.858355 537.404 0.591689 518.47 0.0583554C511.137 -0.208311 505.404 0.458355 502.07 1.65836Z"
              fill="black"
            />
            <path
              d="M232.337 265.258C125.27 372.458 57.0036 441.925 56.0703 444.325C50.0703 460.192 12.0703 572.725 6.47027 590.992C0.870271 609.125 -0.329729 614.858 0.0702714 620.458C1.13694 633.658 10.0703 640.592 24.3369 639.258C38.4703 638.058 70.8703 627.925 143.804 601.792C167.67 593.258 189.804 585.258 193.137 584.192C198.337 582.325 223.004 558.192 374.204 407.125C470.337 310.992 549.137 231.792 549.137 230.992C549.137 229.258 410.204 90.3251 408.47 90.3251C407.67 90.3251 328.47 169.125 232.337 265.258Z"
              fill="black"
            />
          </svg>
          <div class="tooltip">Редактировать</div>
        </div>

        <div class="tooltip-container">
          <svg
            width="25"
            height="25"
            viewBox="0 0 30 30"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
            (click)="selectTool('well')"
            [class.active]="selectedTool === 'well'"
          >
            <path
              fill-rule="evenodd"
              clip-rule="evenodd"
              d="M27.9874 15.5769C27.6856 22.4889 21.9864 28 15 28C8.01361 28 2.3144 22.4889 2.01257 15.5769H27.9874ZM27.9874 14.423H2.01257C2.31445 7.51106 8.01363 2 15 2C21.9864 2 27.6856 7.51106 27.9874 14.423ZM30 15C30 23.2843 23.2843 30 15 30C6.71573 30 0 23.2843 0 15C0 6.71573 6.71573 0 15 0C23.2843 0 30 6.71573 30 15Z"
              fill="#182026"
            />
          </svg>
          <div class="tooltip">Скважина</div>
        </div>

        <div class="tooltip-container">
          <svg
            width="25"
            height="25"
            viewBox="0 0 20 20"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
            (click)="selectTool('pipe')"
            [class.active]="selectedTool === 'pipe'"
          >
            <path
              d="M19.375 0H16.875C16.53 0 16.25 0.28 16.25 0.625V2.86625L2.86625 16.25H0.625C0.28 16.25 0 16.53 0 16.875V19.375C0 19.72 0.28 20 0.625 20H3.125C3.47 20 3.75 19.72 3.75 19.375V17.1337L17.1337 3.75H19.375C19.72 3.75 20 3.47 20 3.125V0.625C20 0.28 19.72 0 19.375 0ZM2.5 18.75H1.25V17.5H2.5V18.75ZM18.75 2.5H17.5V1.25H18.75V2.5Z"
              fill="#182026"
            />
          </svg>
          <div class="tooltip">Труба</div>
        </div>

        <div class="tooltip-container">
          <svg
            width="25"
            height="25"
            viewBox="0 0 30 30"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
            (click)="selectTool('capture')"
            [class.active]="selectedTool === 'capture'"
          >
            <path
              fill-rule="evenodd"
              clip-rule="evenodd"
              d="M13 27.8453C10.2928 27.4238 7.76908 26.1539 5.80761 24.1924C3.36964 21.7544 2 18.4478 2 15C2 11.5522 3.36964 8.24559 5.80761 5.80761C7.76908 3.84614 10.2928 2.5762 13 2.15471L13 15V27.8453ZM15 0C14.3273 0 13.6593 0.0451833 13 0.133871C9.76015 0.569684 6.73079 2.05601 4.3934 4.3934C1.58035 7.20644 0 11.0218 0 15C0 18.9782 1.58035 22.7936 4.3934 25.6066C6.73079 27.944 9.76015 29.4303 13 29.8661C13.6593 29.9548 14.3273 30 15 30V28L15 16H30V14H15L15 2V0Z"
              fill="#182026"
            />
          </svg>

          <div class="tooltip">Каптаж</div>
        </div>

        <div class="tooltip-container">
          <svg
            width="25"
            height="25"
            viewBox="0 0 31 31"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
            (click)="selectTool('pump')"
            [class.active]="selectedTool === 'pump'"
          >
            <path
              fill-rule="evenodd"
              clip-rule="evenodd"
              d="M2.5 2.21436H28.5V28.2144H2.5V2.21436ZM0.5 0.214355H2.5H28.5H30.5V2.21436V28.2144V30.2144H28.5H2.5H0.5V28.2144V2.21436V0.214355ZM21.8333 15.2144C21.8333 18.7122 18.9978 21.5477 15.5 21.5477C12.0022 21.5477 9.16667 18.7122 9.16667 15.2144C9.16667 11.7166 12.0022 8.88102 15.5 8.88102C18.9978 8.88102 21.8333 11.7166 21.8333 15.2144ZM23.8333 15.2144C23.8333 19.8167 20.1024 23.5477 15.5 23.5477C10.8976 23.5477 7.16667 19.8167 7.16667 15.2144C7.16667 10.612 10.8976 6.88102 15.5 6.88102C20.1024 6.88102 23.8333 10.612 23.8333 15.2144Z"
              fill="#182026"
            />
          </svg>

          <div class="tooltip">Насос</div>
        </div>

        <div class="tooltip-container">
          <svg
            width="25"
            height="25"
            viewBox="0 0 30 30"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
            (click)="selectTool('reservoir')"
            [class.active]="selectedTool === 'reservoir'"
          >
            <path
              fill-rule="evenodd"
              clip-rule="evenodd"
              d="M26.008 6H3.99196L15 13.3387L26.008 6ZM28 7.07572L16.8028 14.5405L28 22.0054V7.07572ZM13.1972 14.5405L2 7.07572V22.0054L13.1972 14.5405ZM3.99197 23.0811L15 15.7424L26.008 23.0811H3.99197ZM2 4H0V6V23.0811V25.0811H2H28H30V23.0811V6V4H28H2Z"
              fill="#182026"
            />
          </svg>
          <div class="tooltip">Контр-резервуар</div>
        </div>

        <div class="tooltip-container">
          <svg
            width="25"
            height="25"
            viewBox="0 0 30 30"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
            (click)="selectTool('tower')"
            [class.active]="selectedTool === 'tower'"
          >
            <mask id="path-1-inside-1_525_1863" fill="white">
              <path
                d="M25.6066 4.3934C26.9995 5.78628 28.1044 7.43987 28.8582 9.25976C29.612 11.0796 30 13.0302 30 15C30 16.9698 29.612 18.9204 28.8582 20.7403C28.1044 22.5602 26.9995 24.2137 25.6066 25.6066L20.3033 20.3033C20.9997 19.6069 21.5522 18.7801 21.9291 17.8701C22.306 16.9602 22.5 15.9849 22.5 15C22.5 14.0151 22.306 13.0398 21.9291 12.1299C21.5522 11.2199 20.9997 10.3931 20.3033 9.6967L25.6066 4.3934Z"
              />
            </mask>
            <path
              d="M25.6066 4.3934C26.9995 5.78628 28.1044 7.43987 28.8582 9.25976C29.612 11.0796 30 13.0302 30 15C30 16.9698 29.612 18.9204 28.8582 20.7403C28.1044 22.5602 26.9995 24.2137 25.6066 25.6066L20.3033 20.3033C20.9997 19.6069 21.5522 18.7801 21.9291 17.8701C22.306 16.9602 22.5 15.9849 22.5 15C22.5 14.0151 22.306 13.0398 21.9291 12.1299C21.5522 11.2199 20.9997 10.3931 20.3033 9.6967L25.6066 4.3934Z"
              stroke="#182026"
              stroke-width="2"
              mask="url(#path-1-inside-1_525_1863)"
            />
            <mask id="path-2-inside-2_525_1863" fill="white">
              <path
                d="M4.3934 4.3934C5.78628 3.00052 7.43987 1.89563 9.25976 1.14181C11.0796 0.387989 13.0302 3.24513e-06 15 5.06637e-06C16.9698 6.88762e-06 18.9204 0.387996 20.7403 1.14182C22.5602 1.89564 24.2137 3.00054 25.6066 4.39342L20.3033 9.69671C19.6069 9.00027 18.7801 8.44782 17.8701 8.07091C16.9602 7.694 15.9849 7.50001 15 7.5C14.0151 7.5 13.0398 7.694 12.1299 8.07091C11.2199 8.44781 10.3931 9.00026 9.6967 9.6967L4.3934 4.3934Z"
              />
            </mask>
            <path
              d="M4.3934 4.3934C5.78628 3.00052 7.43987 1.89563 9.25976 1.14181C11.0796 0.387989 13.0302 3.24513e-06 15 5.06637e-06C16.9698 6.88762e-06 18.9204 0.387996 20.7403 1.14182C22.5602 1.89564 24.2137 3.00054 25.6066 4.39342L20.3033 9.69671C19.6069 9.00027 18.7801 8.44782 17.8701 8.07091C16.9602 7.694 15.9849 7.50001 15 7.5C14.0151 7.5 13.0398 7.694 12.1299 8.07091C11.2199 8.44781 10.3931 9.00026 9.6967 9.6967L4.3934 4.3934Z"
              stroke="#182026"
              stroke-width="2"
              mask="url(#path-2-inside-2_525_1863)"
            />
            <mask id="path-3-inside-3_525_1863" fill="white">
              <path
                d="M4.3934 25.6066C3.00052 24.2137 1.89563 22.5601 1.14181 20.7402C0.387988 18.9204 2.67556e-06 16.9698 4.4107e-06 15C6.14584e-06 13.0302 0.387995 11.0796 1.14182 9.25973C1.89564 7.43985 3.00054 5.78626 4.39342 4.39339L9.69671 9.6967C9.00027 10.3931 8.44782 11.2199 8.07091 12.1299C7.694 13.0398 7.5 14.0151 7.5 15C7.5 15.9849 7.694 16.9602 8.0709 17.8701C8.44781 18.7801 9.00026 19.6069 9.6967 20.3033L4.3934 25.6066Z"
              />
            </mask>
            <path
              d="M4.3934 25.6066C3.00052 24.2137 1.89563 22.5601 1.14181 20.7402C0.387988 18.9204 2.67556e-06 16.9698 4.4107e-06 15C6.14584e-06 13.0302 0.387995 11.0796 1.14182 9.25973C1.89564 7.43985 3.00054 5.78626 4.39342 4.39339L9.69671 9.6967C9.00027 10.3931 8.44782 11.2199 8.07091 12.1299C7.694 13.0398 7.5 14.0151 7.5 15C7.5 15.9849 7.694 16.9602 8.0709 17.8701C8.44781 18.7801 9.00026 19.6069 9.6967 20.3033L4.3934 25.6066Z"
              stroke="#182026"
              stroke-width="2"
              mask="url(#path-3-inside-3_525_1863)"
            />
            <mask id="path-4-inside-4_525_1863" fill="white">
              <path
                d="M25.6066 25.6066C24.2137 26.9995 22.5601 28.1044 20.7402 28.8582C18.9204 29.612 16.9698 30 15 30C13.0302 30 11.0796 29.612 9.25974 28.8582C7.43985 28.1044 5.78626 26.9995 4.39339 25.6066L9.6967 20.3033C10.3931 20.9997 11.2199 21.5522 12.1299 21.9291C13.0398 22.306 14.0151 22.5 15 22.5C15.9849 22.5 16.9602 22.306 17.8701 21.9291C18.7801 21.5522 19.6069 20.9997 20.3033 20.3033L25.6066 25.6066Z"
              />
            </mask>
            <path
              d="M25.6066 25.6066C24.2137 26.9995 22.5601 28.1044 20.7402 28.8582C18.9204 29.612 16.9698 30 15 30C13.0302 30 11.0796 29.612 9.25974 28.8582C7.43985 28.1044 5.78626 26.9995 4.39339 25.6066L9.6967 20.3033C10.3931 20.9997 11.2199 21.5522 12.1299 21.9291C13.0398 22.306 14.0151 22.5 15 22.5C15.9849 22.5 16.9602 22.306 17.8701 21.9291C18.7801 21.5522 19.6069 20.9997 20.3033 20.3033L25.6066 25.6066Z"
              stroke="#182026"
              stroke-width="2"
              mask="url(#path-4-inside-4_525_1863)"
            />
          </svg>

          <div class="tooltip">Водонапорная башня</div>
        </div>

        <button class="save-btn" (click)="saveAll()">Сохранить всё</button>
      </header>
      <div class="map-container">
        <div
          *ngIf="showStartObjectMenu"
          class="start-object-menu"
          [ngStyle]="{
            left: startMenuPosition.x + 'px',
            top: startMenuPosition.y + 'px'
          }"
        >
          <div
            class="start-object-item"
            *ngFor="let item of startObjectTypes"
            (click)="selectStartObject(item.id)"
          >
            {{ item.label }}
          </div>
        </div>

        <div id="map"></div>
        <div class="passport-container">
          <div class="passport" *ngFor="let passport of passports">
            <app-passport
              [objectType]="passport.type"
              [objectData]="passport.data"
              [objectId]="convertToNumber(passport.id)"
              (passportClosed)="onPassportClosed($event)"
            ></app-passport>
          </div>
        </div>
      </div>

      <div
        class="context-menu"
        *ngIf="contextMenuVisible"
        [style.left.px]="contextMenuPosition.x"
        [style.top.px]="contextMenuPosition.y"
      >
        <div
          (click)="
            openPassport(
              contextTarget ? contextTarget.type : null,
              contextTarget?.data
            )
          "
        >
          Паспорт объекта
        </div>
        <div (click)="onDelete()">Удалить</div>
      </div>
      <div *ngIf="showDiameterDialog" class="diameter-dialog">
        <div class="dialog-content">
          <label for="pipe-diameter">Выберите диаметр трубы (мм):</label>
          <input
            id="pipe-diameter"
            type="number"
            min="1"
            [(ngModel)]="pipeDiameterInput"
            (keydown.enter)="onDiameterSelected(pipeDiameterInput!)"
            #diameterInput
          />
          <button
            [disabled]="!pipeDiameterInput || pipeDiameterInput <= 0"
            (click)="onDiameterSelected(pipeDiameterInput!)"
          >
            ОК
          </button>
        </div>
      </div>
      <div
        *ngIf="showObjectTypeDialog"
        class="object-type-dialog"
        [style.left.px]="objectTypeDialogPosition.x"
        [style.top.px]="objectTypeDialogPosition.y"
      >
        <div class="object-type-dialog-content">
          <p>Выберите тип объекта:</p>
          <button (click)="onObjectTypeSelected('user')">
            <img src="assets/data/icon/user.png" width="24" height="24" />
            Потребитель
          </button>
          <button (click)="onObjectTypeSelected('capture')">
            <img src="assets/data/images/Каптаж.png" width="24" height="24" />
            Каптаж
          </button>
          <button (click)="onObjectTypeSelected('pump')">
            <img src="assets/data/images/Насос.png" width="24" height="24" />
            Насос
          </button>
          <button (click)="onObjectTypeSelected('reservoir')">
            <img
              src="assets/data/images/контр-резервуар.png"
              width="24"
              height="24"
            />
            Контр-резервуар
          </button>
          <button (click)="onObjectTypeSelected('tower')">
            <img
              src="assets/data/images/Водонапорная башня.png"
              width="24"
              height="24"
            />
            Водонапорная башня
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
